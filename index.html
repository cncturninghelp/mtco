<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MTCO — First Cut (Single-file)</title>
  <style>
    :root {
      --bg: #0f1215;
      --panel: #161a1f;
      --muted: #8a9097;
      --text: #e6e8eb;
      --accent: #ff7a1a;
      --card: #171b21;
      --card-border: #2a3037;
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background: var(--bg); color: var(--text); }
    header { padding: 16px 20px; border-bottom: 1px solid var(--card-border); background: #0e1014; position: sticky; top: 0; z-index: 5; }
    header h1 { margin: 0; font-size: 18px; font-weight: 700; letter-spacing: 0.4px; }
    main { padding: 20px; max-width: 1000px; margin: 0 auto; }

    .hero-visual { margin-top: 12px; }
    .kv { height: 220px; border-radius: var(--radius); border: 1px solid var(--card-border); background: var(--panel); display:flex; align-items:center; justify-content:center; color: var(--muted); }
    .kv small { opacity: 0.8; }

    .grid { display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 16px; margin-top: 16px; }
    .card { background: var(--card); border: 1px solid var(--card-border); border-radius: var(--radius); padding: 14px 14px; }
    .card h3 { margin: 0 0 6px; font-size: 16px; }
    .card p { margin: 0; color: var(--muted); font-size: 14px; line-height: 1.4; }
    .card:hover { border-color: rgba(255,122,26,0.6); }

    @media (max-width: 720px){ .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <header><h1>MTCO — First Cut</h1></header>

  <main>
    <section class="hero-visual">
      <div class="kv">
        <small>Hero visual placeholder — drop a toolpath screenshot here</small>
      </div>
      <div class="grid">
        <div class="card">
          <h3>G/M code trainer</h3>
          <p>Open the interactive G/M code trainer, with examples and quick lookups.</p>
        </div>
        <div class="card">
          <h3>Consistent UI</h3>
          <p>One unified header, tabs, and theme across tools. (Demo layout.)</p>
        </div>
      </div>
    </section>
  </main>

  <!-- === Inline drop-in scripts (exactly the same as the snippet file) === -->
  <!-- === MTCO: ONE-FILE DROP-IN (put this just before </body>) === -->
<!-- Animated Fanuc hero (scoped to the small .kv box) + G/M trainer wiring -->
<script>
(function(){
  // --- HERO: find the .kv hero box ---
  var kv = (function(){
    var s = Array.from(document.querySelectorAll('.kv small'))
      .find(el => (el.textContent||'').toLowerCase().includes('hero visual placeholder'));
    return s ? s.closest('.kv') : document.querySelector('.kv');
  })();
  if(!kv || kv.dataset.mtcoHero === '1') return;
  kv.dataset.mtcoHero = '1';

  // --- Build hero card INSIDE .kv (DO NOT replace .kv itself) ---
  kv.innerHTML = [
    '<div class="mtco-hero-card">',
      '<div class="mtco-hero-tag"  id="mtco-hero-scn">G71 Rough Turning</div>',
      '<div class="mtco-hero-chip" id="mtco-hero-chip">Program</div>',
      '<div class="mtco-hero-vp"><pre class="mtco-hero-code" id="mtco-hero-code"></pre></div>',
    '</div>'
  ].join('');

  // --- Scoped CSS (only once) ---
  if(!document.getElementById('mtco-hero-style')){
    var css = document.createElement('style'); css.id = 'mtco-hero-style';
    css.textContent = [
      '.mtco-hero-card{position:relative;width:100%;height:100%;background:#171b21;border:1px solid #2a3037;border-radius:16px;box-shadow:0 2px 0 rgba(255,122,26,.08) inset;overflow:hidden;}',
      '.mtco-hero-chip{position:absolute;top:10px;right:12px;display:inline-flex;align-items:center;padding:8px 12px;border-radius:999px;border:1px solid #2a3037;background:#161a1f;color:#e6e8eb;font:700 12px system-ui;}',
      '.mtco-hero-tag{position:absolute;top:10px;left:12px;padding:6px 10px;border-radius:999px;border:1px solid #2a3037;background:#11161b;color:#a7aeb6;font:700 11px system-ui;}',
      '.mtco-hero-vp{position:absolute;inset:44px 10px 10px 10px;border-radius:12px;background:#101418;border:1px solid #222831;overflow:hidden;}',
      '.mtco-hero-code{margin:0;padding:10px 12px 18px 12px;height:100%;box-sizing:border-box;font:14px/1.45 ui-monospace,Menlo,Consolas,monospace;color:#e6e8eb;white-space:pre-wrap;word-break:break-word;transform:translateY(0);transition:transform 280ms ease-out;}',
      '.mtco-hero-hl{position:relative;}',
      '.mtco-hero-hl::after{content:"";position:absolute;left:0;right:0;bottom:.08em;height:2px;background:#ff7a1a;opacity:.95;}',
      '@media (prefers-reduced-motion:reduce){.mtco-hero-code{transition:none!important}}'
    ].join('');
    document.head.appendChild(css);
  }

  // --- Animation data (G71, G72, G70, G76) ---
  var defaultScenarios = [
    { title:'G71 Rough Turning', sections:[
      { label:'Program', lines:[
        {t:'M98 P1'},{t:'M41',c:'(Gear Selection)'},{t:'M24',c:'(Swarf Track on)'},{t:'T1011'},
        {t:'G50 S300',c:'(Cap spindle speed)'},{t:'G96 S110 M04'},
        {t:'G00 Z13.0',c:'(Safe move close to job)'},{t:'X405.0',c:'(Billet size)'},
        {t:'G01 Z3.0 F1.0',c:'(Return Z for cycle)'}
      ]},
      { label:'Roughing (G71)', lines:[
        {t:'G71 U3.0 R1.0',hl:'G71',c:'(U=cut, R=retract)'},
        {t:'G71 P100 Q200 U1.0 W0.5 F0.35',c:'(P/Q shape, U/W finish stock)'}
      ]},
      { label:'Profile (P/Q)', lines:[
        {t:'N100 G00 X200.0',c:'(Start smallest Ø)'},
        {t:'G01 Z-100.0'},{t:'G01 X300.0'},{t:'G01 Z-200.0'},
        {t:'N200 G01 X405.0',c:'(Back to billet Ø)'}
      ]},
      { label:'End', lines:[{t:'M98 P1'},{t:'M01'},{t:'M30'}]}
    ]},
    { title:'G72 Rough Facing', sections:[
      { label:'Program', lines:[
        {t:'M98 P1'},{t:'M41'},{t:'M24'},{t:'T0909'},
        {t:'G50 S300'},{t:'G96 S110 M04'},
        {t:'G00 Z15.0'},{t:'G00 X205.0'},{t:'G01 Z5.0 F1.0',c:'(Stock on face)'}
      ]},
      { label:'Facing (G72)', lines:[
        {t:'G72 W2.0 R1.0',hl:'G72',c:'(W=cut in Z, R=retract)'},
        {t:'G72 P100 Q200 U0.0 W0.3 F0.35',c:'(P/Q shape, U/W finish stock)'}
      ]},
      { label:'Profile (P/Q)', lines:[{t:'N100 G00 Z0.0'},{t:'G01 X1.0'},{t:'N200 Z5.0'}]},
      { label:'End', lines:[{t:'M98 P1'},{t:'M01'}]}
    ]},
    { title:'G70 Finishing', sections:[
      { label:'Program', lines:[
        {t:'M98 P1'},{t:'T2020'},{t:'G97 S600 M04',c:'(Const RPM for finish)'},
        {t:'G00 X210.0 Z5.0',c:'(Approach)'}
      ]},
      { label:'Finish pass (G70)', lines:[
        {t:'G70 P100 Q200',hl:'G70',c:'(Finish along stored P/Q profile)'},
        {t:'G18',c:'(XZ plane confirm)'}
      ]},
      { label:'End', lines:[{t:'G00 X405.0 Z13.0'},{t:'M01'}]}
    ]},
    { title:'G76 Threading', sections:[
      { label:'Program', lines:[
        {t:'M98 P1'},{t:'T0505'},
        {t:'G97 S300 M04',c:'(Const RPM to start)'},
        {t:'G00 X25.0 Z3.0',c:'(Approach to thread start)'}
      ]},
      { label:'G76 parameters', lines:[
        {t:'G76 P020060 Q005 R0.05',hl:'G76',c:'(Fin passes, angle, min depth, finish allowance)'},
      ]},
      { label:'Thread cycle', lines:[
        {t:'G76 X20.0 Z-30.0 P800 Q100 F1.5',c:'(Minor Ø, end Z, depth, first cut, pitch)'},
      ]},
      { label:'End', lines:[{t:'M01'}]}
    ]}
  ];

  // --- Animation plumbing ---
  var chip = document.getElementById('mtco-hero-chip');
  var codeEl = document.getElementById('mtco-hero-code');
  var tag   = document.getElementById('mtco-hero-scn');
  var vp    = kv.querySelector('.mtco-hero-vp');
  if(!chip || !codeEl || !tag || !vp) return;

  var RM = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  var CPS = RM ? 120 : 24;
  var GAP = RM ? 0   : 90;
  var HLMS = RM ? 0  : 500;

  function esc(s){return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}
  function autoscroll(){
    var dy = Math.max(0, codeEl.scrollHeight - vp.clientHeight);
    codeEl.style.transform = 'translateY(' + (-dy) + 'px)';
  }
  function lineHTML(obj){
    var code = esc(obj.t);
    var cmt  = obj.c ? ' <span class="mtco-hero-comment">'+esc(obj.c)+'</span>' : '';
    var hlOpen  = obj.hl ? '<span class="mtco-hero-hl">' : '';
    var hlClose = obj.hl ? '</span>' : '';
    return hlOpen + code + hlClose + cmt + '\n';
  }
  function sleep(ms){ return new Promise(r=>setTimeout(r, ms)); }
  async function typeText(el, text, cps){
    var out = '';
    for (var i=0;i<text.length;i++){
      out += text[i];
      el.textContent = out;
      if (!RM) await sleep(1000/cps);
    }
  }
  async function runScenario(scn){
    tag.textContent = scn.title;
    chip.textContent = 'Program';
    codeEl.textContent = ''; codeEl.style.transform='translateY(0)';
    for (var si=0; si<scn.sections.length; si++){
      var section = scn.sections[si];
      chip.textContent = section.label;
      for (var li=0; li<section.lines.length; li++){
        var ln = section.lines[li];
        var html = lineHTML(ln);
        await typeText(codeEl, html, CPS);
        autoscroll();
        if (ln.hl && !RM) await sleep(HLMS);
        if (!RM) await sleep(GAP);
      }
    }
  }
  (async function loop(){
    var i=0;
    while(true){
      await runScenario(defaultScenarios[i % defaultScenarios.length]);
      i++;
    }
  })();
})();
</script>

<script>
// === G/M trainer wiring (delegated, resilient, no once:true) ===
(function(){
  var trainerHref = 'gm_code_trainer.html';
  function norm(s){ return (s||'').replace(/\s+/g,' ').trim().toLowerCase(); }

  function markTargets(){
    var hero = document.querySelector('.hero-visual');
    if (!hero) return;
    // Card with heading "G/M code trainer"
    var cards = hero.querySelectorAll('.grid .card');
    for (var i=0;i<cards.length;i++){
      var card = cards[i];
      var h3 = card.querySelector('h3');
      if (!h3) continue;
      if (norm(h3.textContent) === 'g/m code trainer'){
        card.dataset.gmOpen = '1';
        card.setAttribute('role','link');
        if (!card.hasAttribute('tabindex')) card.setAttribute('tabindex','0');
        card.style.cursor = 'pointer';
      }
    }
    // Any other explicit label "G/M code trainer"
    var nodes = document.querySelectorAll('a,button,[role="button"],.btn,h3,h4,.chip');
    for (var j=0;j<nodes.length;j++){
      var el = nodes[j];
      if (norm(el.textContent) === 'g/m code trainer'){
        el.dataset.gmOpen = '1';
        if (!el.hasAttribute('tabindex')) el.setAttribute('tabindex','0');
        el.style.cursor = 'pointer';
        if (!el.hasAttribute('role')) el.setAttribute('role','link');
      }
    }
  }

  function handleNav(target){
    var trigger = target.closest('[data-gm-open="1"]');
    if (trigger){
      window.location.href = trainerHref;
      return true;
    }
    return false;
  }

  document.addEventListener('click', function(e){
    if (handleNav(e.target)) e.preventDefault();
  });
  document.addEventListener('keydown', function(e){
    if ((e.key === 'Enter' || e.key === ' ') && handleNav(e.target)) e.preventDefault();
  });

  function init(){
    markTargets();
    requestAnimationFrame(markTargets);
    setTimeout(markTargets, 50);
  }
  if (document.readyState === 'complete' || document.readyState === 'interactive') {
    setTimeout(init, 0);
  } else {
    document.addEventListener('DOMContentLoaded', init);
  }

  var host = document.querySelector('.hero-visual') || document.body;
  if (host && 'MutationObserver' in window){
    var mo = new MutationObserver(function(){ markTargets(); });
    mo.observe(host, { childList:true, subtree:true });
  }
})();
</script>
<!-- === /MTCO DROP-IN === -->

</body>
</html>
