<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MTCO — Feeds & Speeds (Lathe + Mill)</title>
  <style>
    :root{
  /* MTCO global type tokens */
  --fs-body: 14px;
  --lh-body: 1.45;
  --fs-small: 12px;
  --fs-title: 16px; /* small in-page title */
  --fs-card: 14px;  /* card/section headers */

      --accent:#ff7a1a; --accent-2:#ffa864;
      --bg:#0f1215; --panel:#161a1f; --text:#e6e8eb; --muted:#8a9097;
      --card:#171b21; --card-border:#2a3037; --radius:16px;
    }
    *{box-sizing:border-box}
    body{margin:0; background:var(--bg); color:var(--text);
         font:14px/1.45 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial}

    /* Hero masthead */
    header.site.masthead{
      position:sticky; top:0; z-index:10;
      background:linear-gradient(180deg,#181d24,#14181d);
      border-bottom:1px solid var(--card-border);
      box-shadow:0 6px 24px rgba(0,0,0,.25);
    }
    header.site.masthead .wrap{
      max-width:1220px; margin:0 auto; padding:18px 14px 10px;
      display:grid; grid-template-columns:1fr auto; gap:12px; align-items:center;
    }
    .brandstack{ display:grid; justify-items:start; gap:6px }
    .brandrow{ display:flex; align-items:center; gap:12px }
    .logo{ width:40px; height:40px; border-radius:10px;
            background:linear-gradient(135deg,var(--accent),var(--accent-2));
            box-shadow:0 2px 14px rgba(255,122,26,.35) }
    .brandtitle{ font-size: clamp(20px, 2.4vw, 28px); font-weight:800; letter-spacing:.4px }
    .tagline{ color:#cfd3d8; font-size:12px }
    .rule{ width:220px; height:3px; border-radius:3px;
            background:linear-gradient(90deg,var(--accent),var(--accent-2)); opacity:.9 }
    .toplinks{ display:flex; gap:10px; justify-self:end }
    .toplinks a{ display:inline-block; padding:7px 12px; border:1px solid #2b3139; border-radius:999px; text-decoration:none; color:var(--text) }
    .toplinks a:hover{ border-color:#3a414b }
    .toplinks a.primary{ background:var(--accent); border-color:var(--accent); color:#101114 }

    /* Main layout & cards (override original light theme) */
    main{ max-width:1220px; margin:14px auto; padding:0 14px 20px }
    .two{ display:grid; gap:16px }
    @media(min-width:980px){ .two{ grid-template-columns:1fr 1fr } }
    .card{ background:var(--card); border:1px solid var(--card-border); border-radius:16px; padding:16px; display:flex; flex-direction:column; gap:14px }
    .row{ display:grid; grid-template-columns:1fr 1fr; gap:10px }
    label{ display:block; font-size:12px; color:var(--muted); margin:6px 0 4px }
    input,select,button{ font-size:14px; width:100%; padding:9px 10px; border:1px solid #2b3139; border-radius:10px; background:#11161c; color:var(--text) }
    select{ appearance:auto }
    button.primary{ background:var(--accent); color:#101114; border-color:var(--accent); cursor:pointer }
    button.primary:hover{ filter:brightness(1.03) }
    .muted{ color:var(--muted); font-size:12px }
    pre{ white-space:pre-wrap; border:1px solid #2b3139; background:#0f141a; color:#dfe3e7;
         padding:12px; border-radius:10px; font:12px/1.4 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono','Courier New', monospace }
    .title{ font-weight:700; margin:2px 0 }
    .tiny{ font-size:12px }
    .bar{ height:1px; background:#2b3139; margin:2px 0 }
    .inline{ display:flex; gap:10px; align-items:end }
    .hint{ font-size:12px; color:var(--muted) }
    .note{ font-size:12px; padding:8px; border-radius:10px; background:#22160f; color:#ffddb8; border:1px solid #3a2518 }

    /* Adjust original container widths */
    header.old{ display:none } /* hide original header if any remained */
  </style>
<style>
/* === MTCO Typography Normalization (site-wide) === */
body { font-size: var(--fs-body); line-height: var(--lh-body); }
label, .label, .hint, .help, .muted, small, .tiny, .badge { font-size: var(--fs-small); }
.inpage-title { font-size: var(--fs-title); font-weight: 600; }
.card h1, .card h2, .card h3, .section-title, .panel h2, .panel h3 { font-size: var(--fs-card); font-weight: 600; }
pre, code, .code, textarea, .output, .editor, textarea.code { font-size: var(--fs-body); line-height: var(--lh-body); }

</style>
<style>
/* === MTCO Typography Normalization (hardened) === */
body { font-size: var(--fs-body) !important; line-height: var(--lh-body) !important; }
label, .label, .hint, .help, .muted, small, .tiny, .badge { font-size: var(--fs-small) !important; }
.inpage-title { font-size: var(--fs-title) !important; font-weight: 600 !important; }
.card h1, .card h2, .card h3, .section-title, .panel h2, .panel h3 { font-size: var(--fs-card) !important; font-weight: 600 !important; }
pre, code, .code, textarea, .output, .editor, textarea.code { font-size: var(--fs-body) !important; line-height: var(--lh-body) !important; }

</style>
</head>
<body>
<!-- Original calculators, reskinned -->
  <main class="two">
    <!-- LATHE CARD -->
    <section class="card">
      <h3 class="title">LatheLogic — feeds &amp; speeds + CSS clamp</h3>

      <div class="row">
        <div>
          <label for="units">Units</label>
          <select id="units">
            <option value="metric">Metric (mm, m/min)</option>
            <option value="imperial">Imperial (inch, SFM)</option>
          </select>
        </div>
        <div>
          <label for="mode">Mode</label>
          <select id="mode">
            <option value="G97">G97 (fixed RPM)</option>
            <option value="G96">G96 (CSS)</option>
          </select>
        </div>
      </div>

      <label for="material">Material (preset Vc)</label>
      <select id="material"></select>

      <div class="row">
        <div>
          <label for="band">Speed band</label>
          <select id="band">
            <option value="low">Low</option>
            <option value="typical" selected>Typical</option>
            <option value="high">High</option>
          </select>
        </div>
        <div>
          <label for="tool">Tool</label>
          <select id="tool">
            <option value="carbide" selected>Carbide</option>
            <option value="hss">HSS</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="coolant">Coolant</label>
          <select id="coolant">
            <option value="dry">Dry</option>
            <option value="flood" selected>Flood</option>
          </select>
        </div>
        <div>
          <label>&nbsp;</label>
          <div id="vcBreakdown" class="muted">Vc = —</div>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="diameter">Diameter (D)</label>
          <input id="diameter" type="number" step="0.001" placeholder="e.g. 50 (mm) or 2.0 (in)">
        </div>
        <div>
          <label for="vc">Surface speed (Vc / SFM)</label>
          <input id="vc" type="number" step="0.1" placeholder="m/min or SFM">
        </div>
      </div>

      <div class="row">
        <div>
          <label for="fpr">Feed per rev (f/rev)</label>
          <input id="fpr" type="number" step="0.001" placeholder="e.g. 0.20 (mm/rev) or 0.008 (in/rev)">
        </div>
        <div>
          <label for="smax">Max spindle clamp (G50 S…)</label>
          <input id="smax" type="number" step="1" placeholder="e.g. 2500">
        </div>
      </div>

      <div class="row">
        <div>
          <label for="dmin">Min Ø in cut (for CSS clamp)</label>
          <input id="dmin" type="number" step="0.001" placeholder="e.g. 10 (mm) or 0.4 (in)">
        </div>
        <div>
          <label for="feedmode">Feed mode</label>
          <select id="feedmode">
            <option value="G99">G99 (per rev)</option>
            <option value="G98">G98 (per minute)</option>
          </select>
        </div>
      </div>

      <button id="calc" class="primary">Calculate lathe</button>

      <div class="bar"></div>
      <div>
        <h4 class="title" style="font-size:14px">Lathe results</h4>
        <div id="out" class="tiny" style="line-height:1.6"></div>
      </div>
      <div>
        <h4 class="title" style="font-size:14px">Lathe G-code suggestion</h4>
        <pre id="gcode">(nothing yet)</pre>
        <p class="muted tiny">G50 is exactly your “Max spindle clamp”. If G96 is active, RPM is capped at that value.</p>
      </div>
    </section>

    <!-- MILLING CARD -->
    <section class="card">
      <h3 class="title">MillingLogic — feeds &amp; speeds (live tooling)</h3>

      <div class="row">
        <div>
          <label for="mat_m">Material</label>
          <select id="mat_m"></select>
        </div>
        <div>
          <label for="band_m">Speed band</label>
          <select id="band_m">
            <option value="low">Low</option>
            <option value="typical" selected>Typical</option>
            <option value="high">High</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="tool_m">Tool</label>
          <select id="tool_m">
            <option value="carbide" selected>Carbide</option>
            <option value="hss">HSS</option>
          </select>
        </div>
        <div>
          <label for="cool_m">Coolant</label>
          <select id="cool_m">
            <option value="dry">Dry</option>
            <option value="flood" selected>Flood</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="vc_m">Surface speed (Vc / SFM)</label>
          <input id="vc_m" type="number" step="0.1" placeholder="m/min or SFM">
        </div>
        <div>
          <label for="d_m">Cutter Ø (D)</label>
          <input id="d_m" type="number" step="0.001" placeholder="e.g. 10 (mm) or 0.375 (in)">
        </div>
      </div>

      <div class="row">
        <div>
          <label for="flutes_m">Flutes (z)</label>
          <input id="flutes_m" type="number" step="1" value="4">
        </div>
        <div>
          <label for="op_m">Operation</label>
          <select id="op_m">
            <option value="rough" selected>Rough</option>
            <option value="finish">Finish</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="ae_pct">Radial width (ae) — % of D</label>
          <input id="ae_pct" type="number" step="1" value="50" placeholder="e.g. 30 for 30% of D">
        </div>
        <div>
          <label for="derate">Live-tool derate</label>
          <input id="derate" type="range" min="0.70" max="1.00" step="0.01" value="0.90" />
          <div class="hint">× <span id="derate_val">0.90</span></div>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="fz_m">Feed per tooth (f<sub>z</sub>) — leave empty to use library suggestion</label>
          <input id="fz_m" type="number" step="0.001" placeholder="e.g. 0.04 (mm/tooth) or 0.0015 (in/tooth)">
        </div>
        <div>
          <label>&nbsp;</label>
          <div id="vcBreakdown_m" class="muted">Vc = —</div>
        </div>
      </div>

      <button id="calc_m" class="primary">Calculate milling</button>

      <div class="bar"></div>
      <div id="out_m" class="tiny" style="line-height:1.6"></div>
      <div id="note_m" class="note" style="display:none"></div>

      <div>
        <h4 class="title" style="font-size:14px">Milling G-code suggestion</h4>
        <pre id="gcode_m">(nothing yet)</pre>
        <p class="muted tiny">
          Milling: RPM(m)= (1000·Vc)/(π·Dmm), RPM(i)= (12·SFM)/(π·Din). Feed (G94) = f<sub>z</sub> · z · RPM.  
          Live-tool spindle M-codes are machine-specific (placeholder shown).
        </p>
      </div>
    </section>
  </main>

  <script>
    // ---------- helpers ----------
    const $ = (id)=>document.getElementById(id);
    const PI = Math.PI;
    const round = (x,d=3)=>Number.parseFloat(x).toFixed(d);

    // Shared material bands (m/min) for Vc (lathe + mill)
    const MATERIALS = {
      P:{label:"Steel (P)",      Vc:[120,180,240]},
      M:{label:"Stainless (M)",  Vc:[ 90,140,200]},
      K:{label:"Cast Iron (K)",  Vc:[ 90,140,200]},
      N:{label:"Aluminium (N)",  Vc:[250,350,600]},
      S:{label:"Superalloy (S)", Vc:[ 30, 60, 90]},
      H:{label:"Hardened (H)",   Vc:[ 40, 80,120]},
    };
    const TOOL_MULT = {carbide:1.00, hss:0.80};
    const COOL_MULT = {dry:0.95, flood:1.00};
    const BAND_MULT = {low:0.95, typical:1.00, high:1.05}; // for fz tendency

    // Unit conversions
    const mmin_to_sfm = v => v*3.28084;
    const sfm_to_mmin = v => v/3.28084;

    // Populate material selects
    function fillMaterialSelect(selId){
      const sel = $(selId); sel.innerHTML="";
      for(const [k,v] of Object.entries(MATERIALS)){
        const o=document.createElement("option");
        o.value=k; o.textContent=`${v.label} — Vc: ${v.Vc.join(" / ")}`;
        sel.appendChild(o);
      }
      sel.value="P";
    }

    // Base Vc (m/min) by dropdowns
    function baseVc(matSelId, bandSelId){
      const mat = $(matSelId).value;
      const band = $(bandSelId).value;
      const [low,typ,high] = MATERIALS[mat].Vc;
      return band==="low" ? low : band==="high" ? high : typ;
    }

    // ----- Lathe presets & UI -----
    function updateVcFromPresets(){
      const u = $("units").value;
      const base = baseVc("material","band");
      const eff_mmin = base * (TOOL_MULT[$("tool").value]||1) * (COOL_MULT[$("coolant").value]||1);
      const shown = (u==="metric") ? eff_mmin : mmin_to_sfm(eff_mmin);
      $("vc").value = Math.round(shown);
      const unitsLabel = (u==="metric") ? "m/min" : "SFM";
      const baseShow = (u==="metric") ? base : mmin_to_sfm(base);
      $("vcBreakdown").textContent = `Vc = ${round(baseShow,0)} × ${(TOOL_MULT[$("tool").value]||1).toFixed(2)} × ${(COOL_MULT[$("coolant").value]||1).toFixed(2)} = ${round(shown,0)} ${unitsLabel}`;
    }

    function onUnitsChange(){
      const u = $("units").value;
      $("diameter").placeholder = (u==="metric")?"e.g. 50 (mm)":"e.g. 2.0 (in)";
      $("vc").placeholder       = (u==="metric")?"m/min":"SFM";
      $("fpr").placeholder      = (u==="metric")?"mm/rev":"inch/rev";
      $("dmin").placeholder     = (u==="metric")?"e.g. 10 (mm)":"e.g. 0.4 (in)";
      $("vc_m").placeholder     = (u==="metric")?"m/min":"SFM";
      $("d_m").placeholder      = (u==="metric")?"e.g. 10 (mm)":"e.g. 0.375 (in)";
      $("fz_m").placeholder     = (u==="metric")?"mm/tooth":"inch/tooth";
      updateVcFromPresets();
      updateVcFromPresets_m();
    }

    // Core calcs
    const rpm_metric   = (Vc,Dmm)=> Dmm>0 ? (1000*Vc)/(PI*Dmm) : 0;
    const rpm_imperial = (SFM,Din)=> Din>0 ? (12*SFM)/(PI*Din) : 0;
    const feed_per_min = (fpr,rpm)=> fpr*rpm;

    function calcLathe(){
      const u = $("units").value;
      const mode = $("mode").value;
      const D = parseFloat($("diameter").value||"0");
      const Vc = parseFloat($("vc").value||"0");
      const fpr = parseFloat($("fpr").value||"0");
      const clamp = Math.round(parseFloat($("smax").value||"0") || 2500); // EXACT user clamp
      const dmin = parseFloat($("dmin").value||"0") || ((u==="metric")?Math.max(1,D*0.2):Math.max(0.05,D*0.2));
      const feedmode = $("feedmode").value;

      let rpm=0, feed=0, rpmAtMin=0;
      if(u==="metric"){
        rpm = rpm_metric(Vc,D);
        if(mode==="G96") rpmAtMin = rpm_metric(Vc,dmin);
        feed = feed_per_min(fpr, rpm);
      }else{
        rpm = rpm_imperial(Vc,D);
        if(mode==="G96") rpmAtMin = rpm_imperial(Vc,dmin);
        feed = feed_per_min(fpr, rpm);
      }

      let clampNote = "";
      if(mode==="G96" && Vc>0 && clamp>0){
        const Dth = (u==="metric") ? (1000*Vc)/(PI*clamp) : (12*Vc)/(PI*clamp);
        clampNote = `CSS reaches clamp below Ø ≈ ${round(Dth, (u==="metric")?1:3)} ${u==="metric"?"mm":"in"}`;
      }

      const lines=[];
      lines.push(`RPM @ D = ${round(rpm,1)}`);
      if(mode==="G96"){
        lines.push(`Est. RPM at min Ø (${dmin}) = ${round(rpmAtMin,1)}`);
        if(clampNote) lines.push(clampNote);
      }
      if(feedmode==="G99") lines.push(`Feed (per min) = f/rev · RPM = ${round(feed,2)} ${u==="metric"?"mm/min":"ipm"}`);
      else lines.push(`Set feed directly in ${u==="metric"?"mm/min":"ipm"} (G98 mode)`);
      $("out").innerHTML = lines.map(s=>`• ${s}`).join('<br>');

      const gc=[];
      gc.push("(SAFE START)");
      gc.push("G18 G40 G80 G99");
      gc.push(`G50 S${clamp}`); // exact clamp
      if(mode==="G97") gc.push(`G97 S${Math.round(rpm)} M3`);
      else gc.push(`G96 S${Math.round(Vc)} M3 ${u==="metric"?"(m/min)":"(SFM)"}`);
      $("gcode").textContent = gc.join("\n");
    }

    // ----- Milling library & UI -----

    // Base steel fz library by diameter band (mm/tooth)
    const BASE_FZ_STEEL = [
      {max:3,   rough:0.020, finish:0.010},
      {max:6,   rough:0.040, finish:0.020},
      {max:12,  rough:0.060, finish:0.030},
      {max:20,  rough:0.100, finish:0.050},
      {max:999, rough:0.150, finish:0.080},
    ];
    // Material multipliers against steel baseline
    const MAT_FZ = {P:1.00, M:0.85, K:1.00, N:1.30, S:0.60, H:0.70};

    function bandFzSteel(Dmm, op){ // op: 'rough'|'finish'
      for(const b of BASE_FZ_STEEL){
        if(Dmm <= b.max) return b[op];
      }
      return BASE_FZ_STEEL.at(-1)[op];
    }

    function thinningFactor(ae_over_D){ // = ae/D
      if(ae_over_D >= 1) return 1.0;                // slot/full: no thinning
      if(ae_over_D <= 0) return 1.0;
      const phi = 2*Math.acos(1 - 2*ae_over_D);     // rad
      const s = Math.sin(phi/2);
      if(s <= 0) return 1.0;
      const f = 1/s;
      return Math.min(Math.max(f,1.0), 1.8);        // clamp to 1.8x to avoid silly boosts
    }

    function updateVcFromPresets_m(){
      const u = $("units").value;
      const base = baseVc("mat_m","band_m");
      const eff_mmin = base * (TOOL_MULT[$("tool_m").value]||1) * (COOL_MULT[$("cool_m").value]||1);
      const shown = (u==="metric") ? eff_mmin : mmin_to_sfm(eff_mmin);
      $("vc_m").value = Math.round(shown);
      const unitsLabel = (u==="metric") ? "m/min" : "SFM";
      const baseShow = (u==="metric") ? base : mmin_to_sfm(base);
      $("vcBreakdown_m").textContent = `Vc = ${round(baseShow,0)} × ${(TOOL_MULT[$("tool_m").value]||1).toFixed(2)} × ${(COOL_MULT[$("cool_m").value]||1).toFixed(2)} = ${round(shown,0)} ${unitsLabel}`;
    }

    function suggest_fz_mm(Dmm, op, matKey, bandKey, toolKey, coolKey, derate, ae_pct){
      const steel = bandFzSteel(Dmm, op);                                // baseline steel mm/tooth
      const matK = MAT_FZ[matKey] ?? 1.0;
      const bandK = BAND_MULT[bandKey] ?? 1.0;
      const toolK = TOOL_MULT[toolKey] ?? 1.0;
      const coolK = COOL_MULT[coolKey] ?? 1.0;
      const aeK   = thinningFactor(Math.max(0, Math.min(1, (ae_pct||100)/100))); // RCT
      return steel * matK * bandK * toolK * coolK * derate * aeK;
    }

    function calcMilling(){
      const u   = $("units").value;
      const Vc  = parseFloat($("vc_m").value||"0");
      const D   = parseFloat($("d_m").value||"0");
      const z   = parseFloat($("flutes_m").value||"0");
      const op  = $("op_m").value;
      const aeP = parseFloat($("ae_pct").value||"100");
      const der = parseFloat($("derate").value||"0.90");

      let rpm = 0;
      if(u==="metric") rpm = rpm_metric(Vc,D);
      else            rpm = rpm_imperial(Vc,D);

      // Build suggestion (mm/tooth), then convert if needed
      const Dmm = (u==="metric") ? D : D*25.4;
      let fz_suggest_mm = suggest_fz_mm(
        Dmm, op, $("mat_m").value, $("band_m").value, $("tool_m").value, $("cool_m").value, der, aeP
      );
      const fz_input = $("fz_m").value.trim();
      let fz_used_mm;

      if(fz_input === ""){
        // auto-fill suggestion
        if(u==="metric"){ $("fz_m").value = round(fz_suggest_mm,3); }
        else{ $("fz_m").value = round(fz_suggest_mm/25.4,4); }
        fz_used_mm = fz_suggest_mm;
      }else{
        // user override
        fz_used_mm = (u==="metric") ? parseFloat(fz_input) : (parseFloat(fz_input)*25.4);
      }

      const feed = z>0 ? (fz_used_mm * rpm * (u==="metric" ? 1 : 1/25.4)) * (u==="metric" ? 1 : 25.4) : 0;
      // Explanation:
      // if metric: fz_mm * z * rpm = mm/min
      // if imperial: fz_in = fz_mm/25.4 ; mm/min => convert to ipm = (fz_mm * z * rpm)/25.4
      const feed_out = (u==="metric") ? (fz_used_mm * z * rpm) : ((fz_used_mm * z * rpm)/25.4);

      // Output panel
      const lines=[];
      lines.push(`RPM = ${round(rpm,1)}`);
      const fz_suggest_out = (u==="metric") ? round(fz_suggest_mm,3)+" mm/tooth" : round(fz_suggest_mm/25.4,4)+" in/tooth";
      const fz_used_out    = (u==="metric") ? round(fz_used_mm,3)+" mm/tooth"    : round(fz_used_mm/25.4,4)+" in/tooth";
      lines.push(`Suggested fz (library × multipliers × RCT × derate): ${fz_suggest_out}`);
      lines.push(`Using fz: ${fz_used_out}  ${fz_input===""?"(auto)":"(manual)"}`);
      if(z>0){
        lines.push(`Feed (G94) = fz · z · RPM = ${round(feed_out,2)} ${u==="metric"?"mm/min":"ipm"}`);
      }else{
        lines.push(`Enter flutes to compute feed rate (G94).`);
      }
      $("out_m").innerHTML = lines.map(s=>`• ${s}`).join('<br>');

      // RCT note if large boost
      const aeK = thinningFactor(Math.max(0, Math.min(1, aeP/100)));
      if(aeK > 1.5){
        $("note_m").style.display = "";
        $("note_m").textContent = `Radial chip-thinning correction is high (×${round(aeK,2)}). Consider increasing ae, or keep an eye on deflection/chatter.`;
      }else{
        $("note_m").style.display = "none";
      }

      // G-code
      if(z>0 && fz_used_mm>0){
        const gc=[];
        gc.push("(MILL SAFE START)");
        gc.push("G18 G40 G80 G94");
        gc.push(`G97 S${Math.round(rpm)}`);
        gc.push(`F${round(feed_out,2)}`);
        gc.push("(MILLING SPINDLE ON, FWD)  (machine-specific M-code)");
        $("gcode_m").textContent = gc.join("\n");
      }else{
        $("gcode_m").textContent = "(nothing yet)";
      }
    }

    // --- wiring & init ---
    function updateVcFromPresets_m(){ // re-declared earlier; keep here for first call
      const u = $("units").value;
      const base = baseVc("mat_m","band_m");
      const eff_mmin = base * (TOOL_MULT[$("tool_m").value]||1) * (COOL_MULT[$("cool_m").value]||1);
      const shown = (u==="metric") ? eff_mmin : mmin_to_sfm(eff_mmin);
      $("vc_m").value = Math.round(shown);
      const unitsLabel = (u==="metric") ? "m/min" : "SFM";
      const baseShow = (u==="metric") ? base : mmin_to_sfm(base);
      $("vcBreakdown_m").textContent = `Vc = ${round(baseShow,0)} × ${(TOOL_MULT[$("tool_m").value]||1).toFixed(2)} × ${(COOL_MULT[$("cool_m").value]||1).toFixed(2)} = ${round(shown,0)} ${unitsLabel}`;
    }

    document.addEventListener("DOMContentLoaded", ()=>{
      fillMaterialSelect("material");
      fillMaterialSelect("mat_m");
      onUnitsChange();
      $("units").addEventListener("change", onUnitsChange);
      ["material","band","tool","coolant"].forEach(id=> $(id).addEventListener("change", updateVcFromPresets));
      ["mat_m","band_m","tool_m","cool_m"].forEach(id=> $(id).addEventListener("change", updateVcFromPresets_m));
      $("calc").addEventListener("click", calcLathe);
      $("calc_m").addEventListener("click", calcMilling);
      $("derate").addEventListener("input", ()=>{$("derate_val").textContent = $("derate").value;});
      updateVcFromPresets();
      updateVcFromPresets_m();
    });
  </script>

<style>
  .back-home-fab {
    position: fixed; right: 14px; bottom: 14px;
    padding: 10px 14px; border-radius: 999px;
    background: var(--accent, #ff7a1a); color: #1b0f07;
    border: 1px solid rgba(0,0,0,.2); font-weight: 700; z-index: 9999;
  }
  @media (min-width: 961px){ .back-home-fab{ display:none; } }
</style>
<a class="back-home-fab" href="index.html" aria-label="Go to MTCO Home">Home</a>

</body>
</html>