<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MTCO — Job Planner (v1)</title>
<style>
:root{
  /* MTCO global type tokens */
  --fs-body: 14px;
  --lh-body: 1.45;
  --fs-small: 12px;
  --fs-title: 16px; /* small in-page title */
  --fs-card: 14px;  /* card/section headers */

  --accent:#ff7a1a; --accent2:#ffa864;
  --bg:#0f1215; --panel:#161a1f; --card:#171b21; --border:#2b3139;
  --text:#e6e8eb; --muted:#aab0b7; --radius:16px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font:14px/1.45 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"}
a{color:var(--text)}
/* Header */
header{position:sticky; top:0; z-index:5; background:linear-gradient(180deg,#181d24,#14181d); border-bottom:1px solid var(--border); box-shadow:0 6px 24px rgba(0,0,0,.25)}
.wrap{max-width:1220px;margin:0 auto;padding:14px;display:grid;grid-template-columns:1fr auto;align-items:center;gap:12px}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:36px;height:36px;border-radius:8px;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:0 2px 12px rgba(255,122,26,.35)}
.brand .title{font-weight:800;font-size:20px;letter-spacing:.4px}
.brand .subtitle{color:#cfd3d8;font-size:12px}
.actions{display:flex;gap:8px;flex-wrap:wrap}
button,.btn{padding:8px 12px;border:1px solid #2b3139;border-radius:10px;background:#11161c;color:var(--text);cursor:pointer}
button.primary{background:var(--accent);border-color:var(--accent);color:#101114}
button:focus{outline:none;box-shadow:0 0 0 2px rgba(255,122,26,.35)}
/* Layout */
main{max-width:1220px;margin:16px auto;padding:0 14px 24px;display:grid;gap:14px}
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:14px}
.card h2{margin:0 0 10px 0;font-size: var(--fs-card);letter-spacing:.3px}
.grid{display:grid;gap:10px}
.grid.cols-2{grid-template-columns:1fr 1fr}
.grid.cols-3{grid-template-columns:repeat(3,1fr)}
.grid.cols-4{grid-template-columns:repeat(4,1fr)}
label{font-size:12px;color:var(--muted);display:block;margin-bottom:4px}
input[type="text"], input[type="number"], input[type="date"], select, textarea{
  width:100%;padding:9px 10px;border:1px solid #2b3139;border-radius:10px;background:#11161c;color:var(--text);
}
textarea{min-height:78px;resize:vertical}
small.help{color:var(--muted)}
/* Tooling table */
.table{width:100%;border-collapse:separate;border-spacing:0 8px}
.table th, .table td{padding:8px 10px;text-align:left}
.table thead th{font-size:12px;color:var(--muted);font-weight:600}
.row{background:#12171d;border:1px solid #2b3139;border-radius:12px;overflow:hidden}
.row td{border-top:1px solid transparent}
.table input{width:100%;padding:7px 8px;border:1px solid #2b3139;border-radius:8px;background:#0f141a;color:var(--text)}
.table .del{white-space:nowrap}
.addrow{margin-top:8px}
/* Drawing attachment */
.preview{width:100%;height:220px;background:#0e1318;border:1px dashed #2b3139;border-radius:12px;display:flex;align-items:center;justify-content:center;overflow:hidden}
.preview img{max-width:100%;max-height:100%;object-fit:contain}
/* Print */
@media print{
  header, .actions .savejson, .actions .loadjson, .actions .downloadjson {display:none !important}
  body{background:#fff;color:#000}
  .card{break-inside:avoid;border-color:#ccc}
  input,select,textarea{border:1px solid #999;background:#fff;color:#000}
  .row{border-color:#ccc;background:#fff}
  .preview{border-color:#999}
}
</style>
<style>
/* === MTCO Typography Normalization (site-wide) === */
body { font-size: var(--fs-body); line-height: var(--lh-body); }
label, .label, .hint, .help, .muted, small, .tiny, .badge { font-size: var(--fs-small); }
.inpage-title { font-size: var(--fs-title); font-weight: 600; }
.card h1, .card h2, .card h3, .section-title, .panel h2, .panel h3 { font-size: var(--fs-card); font-weight: 600; }
pre, code, .code, textarea, .output, .editor, textarea.code { font-size: var(--fs-body); line-height: var(--lh-body); }

</style>
<style>
/* === MTCO Typography Normalization (hardened) === */
body { font-size: var(--fs-body) !important; line-height: var(--lh-body) !important; }
label, .label, .hint, .help, .muted, small, .tiny, .badge { font-size: var(--fs-small) !important; }
.inpage-title { font-size: var(--fs-title) !important; font-weight: 600 !important; }
.card h1, .card h2, .card h3, .section-title, .panel h2, .panel h3 { font-size: var(--fs-card) !important; font-weight: 600 !important; }
pre, code, .code, textarea, .output, .editor, textarea.code { font-size: var(--fs-body) !important; line-height: var(--lh-body) !important; }

</style>
</head>
<body>
<main>
  <section class="card">
    <h2>Job details</h2>
    <div class="grid cols-4">
      <div><label>Customer</label><input id="customer" type="text" placeholder="e.g., Acme Ltd"></div>
      <div><label>Job / WO #</label><input id="job" type="text" placeholder="e.g., WO-10482"></div>
      <div><label>Part name</label><input id="part" type="text" placeholder="e.g., Spindle spacer"></div>
      <div><label>Part # / Rev</label><input id="rev" type="text" placeholder="e.g., P-4421 / B"></div>
    </div>
    <div class="grid cols-4" style="margin-top:10px">
      <div><label>Machine</label><input id="machine" type="text" placeholder="e.g., Fanuc 0i-TF"></div>
      <div><label>Program ID(s)</label><input id="programs" type="text" placeholder="e.g., O1234, O1235"></div>
      <div><label>Work offset(s)</label><input id="offsets" type="text" placeholder="e.g., G54"></div>
      <div><label>Date</label><input id="date" type="date"></div>
    </div>
  </section>

  <section class="card">
    <h2>Part & material</h2>
    <div class="grid cols-4">
      <div><label>Material</label><input id="material" type="text" placeholder="e.g., 1045 steel"></div>
      <div><label>Stock dia × length</label><input id="stock" type="text" placeholder="e.g., ⌀50 × 120 mm"></div>
      <div><label>Qty made</label><input id="qty" type="number" min="1" step="1" placeholder="e.g., 25"></div>
      <div><label>Units</label>
        <select id="units"><option>mm</option><option>inch</option></select>
      </div>
    </div>
    <div class="grid cols-3" style="margin-top:10px">
      <div><label>Coolant</label><input id="coolant" type="text" placeholder="e.g., flood"></div>
      <div><label>Target finish</label><input id="finish" type="text" placeholder="e.g., Ra 3.2 μm"></div>
      <div><label>Notes</label><input id="matNotes" type="text" placeholder="short note"></div>
    </div>
  </section>

  <section class="card">
    <h2>Workholding & setup</h2>
    <div class="grid cols-4">
      <div><label>Chuck / jaws</label><input id="jaws" type="text" placeholder="e.g., 3-jaw, soft jaws OD"></div>
      <div><label>Jaw position</label><input id="jawpos" type="text" placeholder="e.g., station 2"></div>
      <div><label>Zero ref (X/Z)</label><input id="zeros" type="text" placeholder="e.g., OD / face"></div>
      <div><label>Stock allow (X/Z)</label><input id="allow" type="text" placeholder="e.g., 0.5 / 1.0"></div>
    </div>
    <div style="margin-top:10px">
      <label>Setup notes</label>
      <textarea id="setupNotes" placeholder="Indicate jaws, stops, tailstock, probes, special steps..."></textarea>
    </div>
  </section>

  <section class="card">
    <h2>Tooling list</h2>
    <table class="table">
      <thead>
        <tr>
          <th style="width:70px">T No</th>
          <th>Description</th>
          <th style="width:160px">Insert / Grade</th>
          <th style="width:160px">Holder</th>
          <th style="width:90px">Nose R</th>
          <th style="width:120px">Speed (RPM/SFM)</th>
          <th style="width:120px">Feed (mm/rev)</th>
          <th style="width:110px">DOC</th>
          <th style="width:160px">Offsets (X/Z)</th>
          <th class="del" style="width:70px"></th>
        </tr>
      </thead>
      <tbody id="toolBody">
      </tbody>
    </table>
    <button class="addrow" onclick="addTool()">+ Add tool</button>
  </section>

  <section class="card">
    <h2>Inspection / sign-off</h2>
    <div class="grid cols-3">
      <div><label>Critical dims checked</label><input id="qcDims" type="text" placeholder="e.g., ⌀44.8 ±0.02; Z 18.00 ±0.05"></div>
      <div><label>Gauges / notes</label><input id="qcNotes" type="text" placeholder="e.g., mic, bore gauge, radius gauge R2"></div>
      <div><label>Operator</label><input id="operator" type="text" placeholder="name"></div>
    </div>
    <div class="grid cols-3" style="margin-top:10px">
      <div><label>QA</label><input id="qa" type="text" placeholder="initials"></div>
      <div><label>Time stamp</label><input id="stamp" type="text" placeholder="" readonly></div>
      <div><label>General notes</label><input id="genNotes" type="text" placeholder="anything worth noting next time"></div>
    </div>
  </section>

  <section class="card">
    <h2>Attach drawing (optional)</h2>
    <div class="grid cols-3">
      <div>
        <input id="drawFile" type="file" accept="image/*" onchange="loadImage(this)">
        <small class="help">Image will embed so it prints and saves with JSON.</small>
      </div>
      <div class="preview" id="preview"><span style="color:var(--muted)">No image</span></div>
      <div>
        <label>Image note</label>
        <textarea id="imgNote" placeholder="e.g., rev B matches; watch this corner..."></textarea>
      </div>
    </div>
  </section>
</main>

<script>
function $(id){ return document.getElementById(id); }
(function(){ const d=new Date(); $('stamp').value = d.toLocaleString(); })();

function addTool(data){
  const tr=document.createElement('tr'); tr.className='row';
  tr.innerHTML=`
    <td><input type="text" placeholder="e.g., 0101" value="${data?.t||''}"></td>
    <td><input type="text" placeholder="e.g., OD turn CNMG" value="${data?.desc||''}"></td>
    <td><input type="text" placeholder="e.g., CNMG120404 / GC4325" value="${data?.insert||''}"></td>
    <td><input type="text" placeholder="e.g., SCLCR/L 1616H09" value="${data?.holder||''}"></td>
    <td><input type="text" placeholder="e.g., 0.4" value="${data?.nr||''}"></td>
    <td><input type="text" placeholder="e.g., 1200 / 180 SFM" value="${data?.speed||''}"></td>
    <td><input type="text" placeholder="e.g., 0.15" value="${data?.feed||''}"></td>
    <td><input type="text" placeholder="e.g., 1.0 / 0.5" value="${data?.doc||''}"></td>
    <td><input type="text" placeholder="e.g., X: -12.345 / Z: -100.0" value="${data?.ofs||''}"></td>
    <td class="del"><button onclick="this.closest('tr').remove()">Remove</button></td>`;
  $('toolBody').appendChild(tr);
}
addTool();

let imageData=null;
function loadImage(input){
  const f=input.files && input.files[0]; if(!f){ imageData=null; $('preview').innerHTML='<span style="color:var(--muted)">No image</span>'; return;}
  const r=new FileReader();
  r.onload=(e)=>{ imageData=e.target.result; $('preview').innerHTML='<img src="'+imageData+'" alt="drawing">'; };
  r.readAsDataURL(f);
}

function collect(){
  const rows=Array.from(document.querySelectorAll('#toolBody tr')).map(tr=>{
    const i=tr.querySelectorAll('input');
    return {t:i[0].value,desc:i[1].value,insert:i[2].value,holder:i[3].value,nr:i[4].value,speed:i[5].value,feed:i[6].value,doc:i[7].value,ofs:i[8].value};
  });
  return {
    meta:{app:'mtco-job-planner',v:1,savedAt:new Date().toISOString()},
    job:{customer:$('customer').value,job:$('job').value,part:$('part').value,rev:$('rev').value,machine:$('machine').value,programs:$('programs').value,offsets:$('offsets').value,date:$('date').value},
    mat:{material:$('material').value,stock:$('stock').value,qty:$('qty').value,units:$('units').value,coolant:$('coolant').value,finish:$('finish').value,notes:$('matNotes').value},
    setup:{jaws:$('jaws').value,jawpos:$('jawpos').value,zeros:$('zeros').value,allow:$('allow').value,notes:$('setupNotes').value},
    tools:rows,
    qc:{dims:$('qcDims').value,notes:$('qcNotes').value,operator:$('operator').value,qa:$('qa').value,stamp:$('stamp').value,gen:$('genNotes').value},
    image:{data:imageData,note:$('imgNote').value}
  };
}

function exportJSON(){
  const data=collect();
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
  const base=(data.job.part||'job').toLowerCase().replace(/[^a-z0-9]+/g,'-')||'job';
  a.download=base+'_planner.json'; a.click(); URL.revokeObjectURL(a.href);
}

function importJSON(input){
  const f=input.files&&input.files[0]; if(!f)return;
  const r=new FileReader();
  r.onload=(e)=>{
    try{
      const d=JSON.parse(e.target.result);
      $('customer').value=d.job?.customer||''; $('job').value=d.job?.job||''; $('part').value=d.job?.part||''; $('rev').value=d.job?.rev||'';
      $('machine').value=d.job?.machine||''; $('programs').value=d.job?.programs||''; $('offsets').value=d.job?.offsets||''; $('date').value=d.job?.date||'';
      $('material').value=d.mat?.material||''; $('stock').value=d.mat?.stock||''; $('qty').value=d.mat?.qty||''; $('units').value=d.mat?.units||'mm';
      $('coolant').value=d.mat?.coolant||''; $('finish').value=d.mat?.finish||''; $('matNotes').value=d.mat?.notes||'';
      $('jaws').value=d.setup?.jaws||''; $('jawpos').value=d.setup?.jawpos||''; $('zeros').value=d.setup?.zeros||''; $('allow').value=d.setup?.allow||''; $('setupNotes').value=d.setup?.notes||'';
      $('qcDims').value=d.qc?.dims||''; $('qcNotes').value=d.qc?.notes||''; $('operator').value=d.qc?.operator||''; $('qa').value=d.qc?.qa||''; $('stamp').value=d.qc?.stamp||$('stamp').value; $('genNotes').value=d.qc?.gen||'';
      $('toolBody').innerHTML=''; (d.tools||[]).forEach(t=>addTool(t)); if((d.tools||[]).length===0) addTool();
      imageData=d.image?.data||null; $('imgNote').value=d.image?.note||''; $('preview').innerHTML=imageData?('<img src="'+imageData+'">'):'<span style="color:var(--muted)">No image</span>';
    }catch(err){ alert('Could not read JSON file.'); console.error(err); }
  };
  r.readAsText(f);
}

function clearForm(){
  if(!confirm('Clear all fields?')) return;
  document.querySelectorAll('input[type="text"], input[type="number"], input[type="date"], textarea').forEach(el=>el.value='');
  $('units').value='mm'; $('toolBody').innerHTML=''; addTool(); imageData=null; $('preview').innerHTML='<span style="color:var(--muted)">No image</span>';
}
</script>
</body>
</html>
